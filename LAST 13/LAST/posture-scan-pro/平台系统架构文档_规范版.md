# PostureScan Pro 平台系统架构文档

**文档版本**: v2.1.0  
**创建日期**: 2025-12-07  
**文档类型**: 系统架构设计文档  
**适用范围**: PostureScan Pro 体态评估平台

---

## 目录

[Word 中自动生成目录，此处为占位符]

---

## 1. 系统架构总览

### 1.1 整体架构图

本节展示了 PostureScan Pro 平台基于 Electron 的整体架构设计，清晰地划分了主进程、渲染进程、AI计算引擎和数据持久化层。

**[此处插入：图1-1 平台整体架构图]**

```
说明：该图应展示以下内容
- PostureScan Pro 平台（Electron Desktop Application）
- 主进程（Main Process）- Node.js Runtime
- 渲染进程（Renderer Process）- React SPA
- 通过 IPC 通信连接
- 数据库连接池（MySQL Pool）
- MediaPipe Engine（Pose Detection）
- MySQL Database（患者、评估、训练数据）
- 摄像头流（Webcam Stream）

建议使用：流程图或架构图，使用蓝色系配色方案
图标建议：
- 🖥️ 主进程图标
- 🌐 渲染进程图标
- 🗄️ 数据库图标
- 📹 摄像头图标
- 🤖 AI引擎图标
```

### 1.2 架构特点

| 特点 | 说明 |
|:-----|:-----|
| **跨平台性** | 基于Electron，支持Windows、macOS、Linux |
| **前后端分离** | React前端 + Node.js后端，通过IPC通信 |
| **实时计算** | MediaPipe实时姿态检测，30-60fps |
| **离线运行** | 本地数据库，无需联网（模型需首次加载） |
| **模块化设计** | 功能模块解耦，易于扩展和维护 |
| **状态隔离** | Context API管理全局状态，避免状态污染 |

---

## 2. 技术架构层次

### 2.1 四层架构模型

本平台遵循标准的四层架构模型，确保了关注点分离和高内聚低耦合的设计原则。

**[此处插入：图2-1 四层架构模型图]**

```
说明：该图应展示四层架构
从上至下：
1. 表现层（Presentation Layer）
   - React Components（UI组件）
   - CSS Modules（样式）
   - React Router（路由）

2. 业务逻辑层（Business Logic Layer）
   - 姿态分析算法（postureCalculator.js）
   - 运动评估逻辑（squatUtils.js, bicepCurlUtils.js）
   - 状态机（Reducer）
   - Context Providers

3. 服务层（Service Layer）
   - IPC通信服务（window.api.*）
   - MediaPipe服务
   - 摄像头服务

4. 数据访问层（Data Access Layer）
   - MySQL连接池
   - IPC Handlers
   - 数据库CRUD操作

建议使用：分层架构图，使用渐变色区分各层
配色建议：紫色（表现层）→ 蓝色（业务层）→ 绿色（服务层）→ 橙色（数据层）
```

### 2.2 技术栈映射

| 层次 | 技术栈 | 文件/目录 |
|:-----|:-------|:----------|
| **表现层** | React 18.2, CSS3, React Router 6 | /src/components, /src/pages |
| **业务逻辑层** | JavaScript ES6+, React Hooks | /src/modules/*/utils.js, /src/contexts |
| **服务层** | MediaPipe, IPC, Webcam API | app/preload.js, MediaPipe SDK |
| **数据访问层** | MySQL2, Node.js | app/main.js, MySQL数据库 |

---

## 3. 核心功能模块架构

### 3.1 模块划分总览

**[此处插入：图3-1 功能模块结构图]**

```
说明：展示系统功能模块树形结构
PostureScan Pro
├── 👥 人员管理模块（Patient Management）
├── 🧍 静态体态评估模块（Static Posture Assessment）
├── 🏃 运动纠正模块（Motion Correction）
│   ├── 🦵 深蹲训练子模块（Squat Training）
│   └── 💪 二头弯举子模块（Bicep Curl）
├── 🦴 脊柱曲率分析模块（Spinal Curvature Analysis）
├── 📊 报告管理模块（Report Management）
├── 📈 数据展示模块（Data Visualization）
└── ⚙️ 系统管理模块（System Management）

建议使用：树形图或思维导图
配色建议：使用医疗蓝色系主色调，各模块用不同深浅区分
```

### 3.2 人员管理模块架构

#### 3.2.1 模块职责

- 人员信息的增删改查（CRUD）
- 人员列表展示与搜索
- 人员详情页与评估历史关联

#### 3.2.2 组件架构

**[此处插入：图3-2 人员管理组件架构图]**

```
说明：展示Dashboard组件的层次结构
Dashboard（人员管理主页）
├── 数据获取：useEffect + window.api.getPatients()
├── 状态管理：useState (patients, isLoading, error)
├── 子组件：
│   ├── PatientTable（人员列表表格）
│   │   ├── 行点击 → 导航到PatientDetailPage
│   │   ├── 编辑按钮 → 打开PatientFormModal
│   │   └── 删除按钮 → 确认删除
│   └── PatientFormModal（人员表单弹窗）
│       ├── 新增模式：patient = null
│       └── 编辑模式：patient = {...}
└── 操作流程：
    ├── 添加人员：handleSavePatient → window.api.addPatient
    ├── 更新人员：handleSavePatient → window.api.updatePatient
    └── 删除人员：handleDeletePatient → window.api.deletePatient

建议使用：组件层次图
图标建议：📝 表单、📋 列表、➕ 添加、✏️ 编辑、🗑️ 删除
```

#### 3.2.3 数据流图

**[此处插入：图3-3 人员管理数据流图]**

```
说明：展示数据流向
用户操作 → React Component → IPC调用 → Main进程 → MySQL数据库
   ↓                                                    │
   └────────────── 更新UI ← 返回数据 ←──────────────────┘

建议使用：流程图，使用箭头表示数据流向
配色建议：用户操作（绿色）→ 组件（蓝色）→ IPC（紫色）→ 数据库（橙色）
```

#### 3.2.4 API接口定义

| 方法 | IPC通道 | 参数 | 返回值 |
|:-----|:--------|:-----|:-------|
| getPatients() | db:get-patients | 无 | Array\<Patient\> |
| getPatientById(id) | db:get-patient-by-id | number | Patient \| null |
| addPatient(patient) | db:add-patient | PatientInput | Patient |
| updatePatient(patient) | db:update-patient | Patient | Patient |
| deletePatient(id) | db:delete-patient | number | number |

---

### 3.3 静态体态评估模块架构

#### 3.3.1 模块职责

- 实时摄像头捕获
- MediaPipe人体33个关键点检测
- 多平面角度计算（矢状面、冠状面、横断面）
- 平衡指数计算
- 姿态建议生成

#### 3.3.2 组件架构

**[此处插入：图3-4 体态捕获组件架构图]**

```
说明：展示PostureCapture组件的完整架构
PostureCapture（体态捕获主组件）
├── 初始化层
│   ├── MediaPipe Pose初始化
│   │   ├── locateFile: CDN模型加载
│   │   ├── setOptions: 模型参数配置
│   │   └── onResults: 结果回调
│   └── Camera初始化
│       ├── getUserMedia: 请求摄像头权限
│       └── Camera实例: 帧回调
├── 计算层（postureCalculator.js）
│   ├── calculateAngle3D: 3D角度计算
│   ├── calculateRoll: 滚转角计算
│   ├── calculatePosture: 姿态计算主函数
│   │   ├── 矢状面角度（head, neck, trunk, pelvis）
│   │   ├── 冠状面角度（shoulders, pelvis, head）
│   │   ├── 横断面角度（shoulders, pelvis）
│   │   └── 平衡指数（overall, sagittal, coronal, transverse）
│   └── getPostureAdvice: 姿态建议生成
├── 渲染层
│   ├── Video元素: 摄像头流
│   ├── Canvas元素: 骨骼叠加绘制
│   │   ├── drawConnectors: 骨骼连线
│   │   ├── drawLandmarks: 关键点绘制
│   │   └── drawCanvas: 自定义绘制逻辑
│   └── AnalysisPanel: 数据展示面板
└── 交互层
    ├── CaptureToolbar: 工具栏
    │   ├── 开始/停止摄像头
    │   ├── 校准功能
    │   ├── 拍照捕获
    │   └── 保存报告
    └── SettingsPanel: 设置面板
        ├── 水平翻转
        ├── 显示骨骼
        ├── 显示关键点
        └── 显示角度标注

建议使用：分层架构图
图标建议：🎥 摄像头、🧮 计算、🎨 渲染、⚙️ 设置
```

#### 3.3.3 数据处理流程

**[此处插入：图3-5 姿态捕获数据处理流程图]**

```
说明：展示实时数据处理流程
摄像头帧 → MediaPipe Pose → 33个关键点 → 姿态计算器 → 角度数据
   ↓                                                        ↓
Video元素                                            PostureData状态
   ↓                                                        ↓
Canvas绘制 ← 骨骼叠加 ← DrawingUtils            AnalysisPanel展示

建议使用：横向流程图
配色建议：输入（蓝色）→ 处理（绿色）→ 输出（橙色）
```

#### 3.3.4 MediaPipe配置参数

| 参数 | 值 | 说明 |
|:-----|:---|:-----|
| modelComplexity | 1 | 模型复杂度（0=轻量/1=平衡/2=精准） |
| smoothLandmarks | true | 启用关键点平滑 |
| enableSegmentation | false | 禁用人体分割（提高性能） |
| minDetectionConfidence | 0.5 | 最小检测置信度 |
| minTrackingConfidence | 0.5 | 最小追踪置信度 |

---

### 3.4 运动纠正模块架构

#### 3.4.1 深蹲训练子模块

**模块职责**：
- 实时监测深蹲动作
- 自动计数
- 动作质量评分
- 实时反馈提示
- 训练报告生成

**[此处插入：图3-6 深蹲训练状态机图]**

```
说明：展示深蹲训练的状态转换流程
┌─────────┐
│ CONFIG  │（配置阶段）
└────┬────┘
     │ START_SESSION（用户设定目标次数）
     ▼
┌─────────────┐
│INITIALIZING │（初始化，检测稳定姿态）
└──────┬──────┘
       │ INITIALIZED（检测到稳定站立）
       ▼
┌──────────┐ ◄──────────────────┐
│   IDLE   │（准备状态）          │
└────┬─────┘                     │
     │ START_SQUAT               │ 继续下一次
     │（膝盖角度 < 160°）         │
     ▼                           │
┌───────────┐                    │
│SQUATTING  │（下蹲中）            │
└─────┬─────┘                    │
      │ END_SQUAT                │
      │（膝盖角度 > 165°）         │
      ▼                          │
┌──────────┐                     │
│ANALYZING │（分析动作质量）       │
└────┬─────┘                     │
     │ 分析完成                   │
     ├──────────────────────────┘（未达目标）
     │
     │ 达到目标次数
     ▼
┌──────────┐
│ COMPLETE │（训练完成）
└──────────┘

建议使用：状态机图
配色建议：配置（灰色）→ 初始化（黄色）→ 训练中（绿色）→ 完成（蓝色）
图标建议：⚙️ 配置、🔄 初始化、🏃 训练、✅ 完成
```

#### 3.4.2 二头弯举子模块

**[此处插入：图3-7 二头弯举姿势示意图]**

```
说明：展示标准二头弯举姿势的关键点
- 左侧：起始姿势（手臂伸展，肘部角度约145°）
- 右侧：顶峰姿势（手臂弯曲，肘部角度约65°）
- 高亮显示：肩-肘-腕连线
- 标注：肘部角度、肩部稳定性检测区域

建议使用：人体骨骼示意图
配色建议：骨骼（白色）、高亮连线（橙色）、角度标注（绿色）
```

---

## 4. 数据流架构

### 4.1 数据流向总览

**[此处插入：图4-1 平台数据流向总览图]**

```
说明：展示从用户交互到UI更新的完整数据流
┌─────────────────────────────────────────────────────────────────┐
│                        用户交互层                                 │
│               （用户点击、输入、摄像头操作）                        │
└───────────────────────────┬─────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                     React组件层                                   │
│  - 状态更新（useState, useReducer）                                │
│  - 事件处理函数（handleXxx）                                       │
└─────────────┬───────────────────────────────┬───────────────────┘
              ↓                               ↓
    ┌─────────────────┐           ┌───────────────────────┐
    │  IPC调用        │           │  MediaPipe处理        │
    │ （数据库操作）    │           │ （姿态检测）           │
    └────────┬────────┘           └──────────┬────────────┘
             ↓                               ↓
    ┌─────────────────┐           ┌───────────────────────┐
    │  Main进程       │           │  onResults回调        │
    │ （IPC Handlers） │           │ （关键点数据）         │
    └────────┬────────┘           └──────────┬────────────┘
             ↓                               ↓
    ┌─────────────────┐           ┌───────────────────────┐
    │  MySQL数据库    │           │  业务逻辑处理          │
    │ （持久化存储）    │           │ （角度计算、评分）      │
    └────────┬────────┘           └──────────┬────────────┘
             │                               │
             └───────────────┬───────────────┘
                             ↓
                   ┌──────────────────┐
                   │  React状态更新   │
                   │ （触发重渲染）     │
                   └──────────────────┘
                             ↓
                   ┌──────────────────┐
                   │  UI更新显示      │
                   └──────────────────┘

建议使用：垂直流程图
配色建议：使用不同颜色区分数据流路径
```

---

## 5. 进程间通信架构

### 5.1 IPC通信机制

**[此处插入：图5-1 IPC通信机制图]**

```
说明：展示Electron的IPC安全通信架构
┌──────────────────────────────────────────────────────────────┐
│                    渲染进程（Renderer Process）                │
│                         React应用                             │
└───────────────────────────┬──────────────────────────────────┘
                            │
                            │ window.api.xxx()
                            ↓
┌──────────────────────────────────────────────────────────────┐
│                    预加载脚本（Preload Script）                │
│              contextBridge.exposeInMainWorld('api', {...})    │
│                                                               │
│              安全桥接层 - 白名单暴露API                          │
└───────────────────────────┬──────────────────────────────────┘
                            │
                            │ ipcRenderer.invoke(channel, args)
                            ↓
┌──────────────────────────────────────────────────────────────┐
│                      主进程（Main Process）                    │
│              ipcMain.handle(channel, handler)                 │
│                                                               │
│          业务逻辑层 - 数据库操作、文件系统访问                     │
└───────────────────────────┬──────────────────────────────────┘
                            │
                            │ dbPool.query() / fs操作
                            ↓
┌──────────────────────────────────────────────────────────────┐
│                   外部资源（External Resources）               │
│              MySQL数据库、文件系统、操作系统API                 │
└──────────────────────────────────────────────────────────────┘

建议使用：分层通信图
配色建议：渲染进程（蓝色）→ 预加载（紫色）→ 主进程（绿色）→ 资源（橙色）
图标建议：🔒 安全隔离、🌉 桥接、⚡ 通信
```

### 5.2 IPC接口清单

#### 5.2.1 人员管理接口

| 渲染进程API | IPC通道 | 主进程Handler | 数据库操作 |
|:-----------|:--------|:-------------|:----------|
| getPatients() | db:get-patients | ipcMain.handle('db:get-patients') | SELECT * FROM patients |
| getPatientById(id) | db:get-patient-by-id | ipcMain.handle('db:get-patient-by-id') | SELECT * FROM patients WHERE id=? |
| addPatient(patient) | db:add-patient | ipcMain.handle('db:add-patient') | INSERT INTO patients VALUES(...) |
| updatePatient(patient) | db:update-patient | ipcMain.handle('db:update-patient') | UPDATE patients SET ... WHERE id=? |
| deletePatient(id) | db:delete-patient | ipcMain.handle('db:delete-patient') | DELETE FROM patients WHERE id=? |

---

## 6. 状态管理架构

### 6.1 状态管理层次

**[此处插入：图6-1 状态管理层次结构图]**

```
说明：展示全局状态和组件级状态的层次关系
全局状态（Context API）
├── TrainingSessionContext
│   ├── isTrainingActive: boolean
│   ├── exerciseType: 'squat' | 'bicep-curl' | null
│   ├── startTraining(type): void
│   └── endTraining(): void
└── （未来扩展）
    ├── UserContext（用户偏好设置）
    └── ThemeContext（主题切换）

组件级状态（useState / useReducer）
├── Dashboard
│   ├── patients: Array<Patient>
│   ├── isLoading: boolean
│   └── error: string | null
├── PostureCapture
│   ├── poseResults: MediaPipe.Results
│   ├── postureData: PostureData
│   ├── alerts: Record<string, string>
│   ├── isCameraActive: boolean
│   └── settings: CaptureSettings
├── StandardSquat / BicepCurl
│   ├── state: SquatState（通过useReducer管理）
│   │   ├── sessionState: string
│   │   ├── count: number
│   │   ├── feedback: string
│   │   └── liveMetrics: Metrics
│   └── settings: ExerciseSettings
└── Reports
    ├── assessments: Array<Assessment>
    └── selectedAssessment: Assessment | null

建议使用：树形层次图
配色建议：全局状态（深蓝色）、组件状态（浅蓝色）
图标建议：🌐 全局、📦 组件
```

---

## 7. AI计算引擎架构

### 7.1 MediaPipe Pose引擎

**[此处插入：图7-1 MediaPipe Pose引擎架构图]**

```
说明：展示MediaPipe的工作原理和架构
┌────────────────────────────────────────────────────────┐
│              MediaPipe Pose Detection                  │
│                                                         │
│  ┌──────────────────────────────────────────────────┐ │
│  │  BlazePose模型（Google研发）                       │ │
│  │  - 轻量级CNN网络                                   │ │
│  │  - 支持实时检测（30-60fps）                        │ │
│  │  - 33个3D关键点输出                               │ │
│  └──────────────────────────────────────────────────┘ │
│                       ↓↑                               │
│  ┌──────────────────────────────────────────────────┐ │
│  │  WebAssembly运行时（浏览器端）                     │ │
│  │  - 模型从CDN加载                                  │ │
│  │  - WASM高性能计算                                 │ │
│  └──────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────┘
                         ↓↑
┌────────────────────────────────────────────────────────┐
│              Camera Utils（摄像头工具）              │
│  - 视频流捕获                                       │
│  - 帧率控制                                         │
│  - 分辨率适配                                       │
└────────────────────────────────────────────────────────┘

建议使用：架构图
配色建议：AI模型（深蓝色）、运行时（绿色）、硬件（橙色）
图标建议：🤖 AI、⚡ WASM、📹 摄像头
```

### 7.2 关键点检测流程

**[此处插入：图7-2 关键点检测流程图]**

```
说明：展示从摄像头到关键点输出的完整流程
摄像头捕获 → 图像预处理 → BlazePose模型推理 → 关键点坐标输出
  （720p）      （归一化）      （WASM运行）         （33个点）
                                                    ↓
                                          {x, y, z, visibility}
                                          - x, y: 归一化坐标 [0,1]
                                          - z: 深度（相对于骨盆）
                                          - visibility: 可见度 [0,1]

建议使用：横向流程图
配色建议：输入（绿色）→ 处理（蓝色）→ 输出（橙色）
```

---

## 8. 数据持久化架构

### 8.1 数据库架构

**[此处插入：图8-1 MySQL数据库ER关系图]**

```
说明：展示数据库表结构及关系
┌────────────────┐         ┌─────────────────────┐
│   patients     │         │  exercise_categories│
├────────────────┤         ├─────────────────────┤
│ id (PK)        │         │ id (PK)             │
│ name           │◄────┐   │ name                │
│ gender         │     │   │ description         │
│ age            │     │   └──────────┬──────────┘
│ height         │     │              │
│ weight         │     │              │ 1:N
│ created_at     │     │              ↓
│ updated_at     │     │   ┌─────────────────────┐
└────────┬───────┘     │   │   exercises         │
         │             │   ├─────────────────────┤
         │ 1:N         │   │ id (PK)             │
         ↓             │   │ category_id (FK)    │
┌────────────────┐     │   │ name                │
│  assessments   │     │   │ slug                │
├────────────────┤     │   │ description         │
│ id (PK)        │     │   └─────────────────────┘
│ patient_id (FK)│─────┘
│ assessment_data│ (JSON)
│ screenshot     │ (LONGTEXT)
│ created_at     │
└────────────────┘

建议使用：ER关系图
配色建议：主表（蓝色）、关联表（绿色）
图标建议：🔑 主键、🔗 外键、📊 数据字段
```

### 8.2 数据表详细设计

#### 8.2.1 patients表

| 字段名 | 数据类型 | 约束 | 说明 |
|:------|:--------|:-----|:-----|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 主键 |
| name | VARCHAR(100) | NOT NULL | 姓名 |
| gender | ENUM('男','女','其他') | NOT NULL | 性别 |
| age | INT | NOT NULL | 年龄 |
| height | DECIMAL(5,2) | NULL | 身高(cm) |
| weight | DECIMAL(5,2) | NULL | 体重(kg) |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 8.2.2 assessments表

| 字段名 | 数据类型 | 约束 | 说明 |
|:------|:--------|:-----|:-----|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 主键 |
| patient_id | INT | NOT NULL, FOREIGN KEY | 关联人员ID |
| assessment_data | JSON | NOT NULL | 评估数据（JSON格式） |
| screenshot | LONGTEXT | NULL | 截图（Base64编码） |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 评估时间 |

---

## 9. 前端组件架构

### 9.1 组件层次结构

**[此处插入：图9-1 前端组件层次结构图]**

```
说明：展示React组件的完整层次结构
App
├── TrainingSessionProvider（全局训练状态）
└── Router
    └── Layout（主布局）
        ├── Sidebar（侧边栏导航）
        │   ├── Logo
        │   ├── NavItems
        │   └── Footer
        ├── MainContent（内容区）
        │   └── Routes
        │       ├── Welcome（欢迎页）
        │       ├── Dashboard（人员管理）
        │       │   └── PatientFormModal
        │       ├── PatientDetailPage
        │       ├── PostureCapture（体态捕获）
        │       │   ├── Video + Canvas
        │       │   ├── AnalysisPanel
        │       │   ├── CaptureToolbar
        │       │   └── SettingsPanel
        │       ├── SpinalCurvature（脊柱分析）
        │       ├── ExerciseSelectionPage（运动选择）
        │       ├── ExerciseAnalysisPage（深蹲训练）
        │       ├── BicepCurlAnalysisPage（二头弯举）
        │       ├── Reports（报告列表）
        │       ├── ReportDetailPage（报告详情）
        │       └── DatasetShowcase（数据展示）
        └── WarningModal（训练警告弹窗）

建议使用：树形组件图
配色建议：根组件（深蓝）→ 布局组件（蓝）→ 页面组件（浅蓝）
图标建议：📱 页面、🧩 组件、🔧 工具
```

### 9.2 Canvas绘制架构

**[此处插入：图9-2 Canvas绘制流程图]**

```
说明：展示Canvas的分层绘制流程
Canvas绘制流程
├── 1. 清空画布
│   ctx.clearRect(0, 0, width, height)
├── 2. 绘制视频帧
│   ctx.drawImage(videoElement, 0, 0, width, height)
├── 3. 绘制MediaPipe骨骼
│   ├── drawConnectors(ctx, landmarks, POSE_CONNECTIONS)
│   └── drawLandmarks(ctx, landmarks)
├── 4. 绘制自定义指标线
│   └── drawMetrics(ctx, linesToDraw)
│       ├── 贝塞尔曲线连接
│       ├── 渐变色填充
│       └── 发光效果
└── 5. 绘制文本标注
    ├── 角度数值
    ├── 实时反馈
    └── 计数显示

建议使用：流程图
配色建议：各绘制层使用不同颜色
图标建议：🎨 绘制、📐 几何、💡 效果
```

---

## 10. 安全架构

### 10.1 Electron安全机制

**[此处插入：图10-1 Electron安全架构图]**

```
说明：展示Electron的安全隔离机制
┌─────────────────────────────────────────────────────────────┐
│              Electron安全最佳实践                        │
└─────────────────────────────────────────────────────────────┘

1. Context Isolation（上下文隔离）
   ├── webPreferences.contextIsolation = true
   ├── 渲染进程无法直接访问Node.js
   └── 只能通过contextBridge暴露的API通信

2. Node Integration（禁用Node集成）
   ├── webPreferences.nodeIntegration = false
   ├── 渲染进程无require权限
   └── 防止恶意脚本注入

3. Preload Script（预加载脚本）
   ├── 白名单暴露API
   ├── 参数验证
   └── 错误处理

4. CSP（内容安全策略）
   └── 防止XSS攻击

5. IPC安全
   ├── 使用ipcRenderer.invoke（异步、安全）
   ├── 避免ipcRenderer.send（同步、不安全）
   └── 主进程验证所有输入

建议使用：安全架构图
配色建议：安全机制（绿色）、风险点（红色）、隔离层（黄色）
图标建议：🔒 安全、⚠️ 风险、🛡️ 防护
```

### 10.2 数据安全

#### 10.2.1 敏感信息保护

**环境变量配置**（.env文件，不提交到Git）：
```
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=****** # 敏感信息
DB_DATABASE=posture_scan_pro_db
```

#### 10.2.2 SQL注入防护

❌ **不安全**（SQL注入风险）：
```javascript
const sql = `SELECT * FROM patients WHERE name = '${name}'`;
```

✅ **安全**（参数化查询）：
```javascript
const sql = 'SELECT * FROM patients WHERE name = ?';
const [rows] = await dbPool.execute(sql, [name]);
```

---

## 附录

### A. 技术栈版本清单

| 技术 | 版本 | 说明 |
|:-----|:-----|:-----|
| Electron | ^31.0.2 | 桌面应用框架 |
| React | ^18.2.0 | 前端UI框架 |
| React Router DOM | ^6.30.1 | 路由管理 |
| @mediapipe/pose | ^0.5.1675469404 | 姿态检测 |
| @mediapipe/camera_utils | ^0.3.1675466862 | 摄像头工具 |
| @mediapipe/drawing_utils | ^0.3.1675466124 | 绘图工具 |
| mysql2 | ^3.10.1 | MySQL连接 |
| chart.js | ^3.7.0 | 图表库 |
| react-webcam | ^7.2.0 | Webcam组件 |
| react-icons | ^5.5.0 | 图标库 |
| dotenv | ^16.4.5 | 环境变量 |
| concurrently | ^8.2.2 | 并发命令 |
| wait-on | ^7.2.0 | 等待服务 |
| cross-env | ^7.0.3 | 跨平台环境变量 |

### B. 目录结构总览

```
posture-scan-pro/
├── app/                        # Electron主进程
│   ├── main.js                 # 主进程入口
│   └── preload.js              # 预加载脚本
├── public/                     # 静态资源
│   └── index.html
├── src/                        # React源代码
│   ├── index.js                # React入口
│   ├── App.js                  # 根组件
│   ├── components/             # 通用组件
│   ├── pages/                  # 路由页面
│   ├── modules/                # 功能模块
│   │   ├── patient/            # 人员管理
│   │   ├── posture/            # 姿态检测
│   │   ├── analysis/           # 分析模块
│   │   └── reports/            # 报告模块
│   ├── contexts/               # React Context
│   └── services/               # 服务层
├── .env                        # 环境变量
├── package.json                # 项目配置
└── README.md                   # 项目说明
```

### C. 启动命令速查

```bash
# 安装依赖
npm install

# 仅启动React开发服务器（端口3000）
npm start

# 仅启动Electron窗口
npm run electron

# 同时启动React和Electron（推荐）
npm run electron:start

# 构建生产版本
npm run build

# 打包为桌面应用
npx electron-builder --mac    # macOS
npx electron-builder --win    # Windows
npx electron-builder --linux  # Linux
```

### D. 性能优化建议

**[此处插入：图D-1 性能优化策略图]**

```
说明：展示系统各层面的性能优化策略
性能优化策略
├── MediaPipe优化
│   ├── 降低modelComplexity（0=最快）
│   ├── 限制检测频率（30fps足够）
│   └── 减小视频分辨率（720p vs 1080p）
├── React优化
│   ├── 使用useMemo缓存计算结果
│   ├── 使用useCallback缓存函数
│   └── 使用React.memo避免无意义重渲染
├── Canvas优化
│   ├── 减少绘制范围
│   ├── 使用requestAnimationFrame
│   └── 避免频繁的状态更新
└── 数据库优化
    ├── 合理使用索引
    ├── 使用连接池
    └── 避免N+1查询

建议使用：分类树形图
配色建议：不同优化类别使用不同颜色
图标建议：⚡ 性能、🚀 优化、📊 监控
```

### E. 故障排查清单

| 问题 | 可能原因 | 解决方案 |
|:-----|:---------|:---------|
| 数据库连接失败 | MySQL未启动/.env配置错误 | 检查MySQL服务/验证.env配置 |
| 摄像头无法访问 | 权限被拒绝/被其他应用占用 | 检查系统权限/关闭其他应用 |
| MediaPipe加载失败 | 网络问题/CDN不可达 | 检查网络/使用本地模型 |
| 白屏问题 | React编译错误/路由配置错误 | 打开DevTools查看错误 |
| 训练数据丢失 | 中途切换页面/组件卸载 | 使用TrainingSessionContext保护 |

---

## 文档版本历史

| 版本 | 日期 | 修改内容 | 作者 |
|:-----|:-----|:---------|:-----|
| 2.1.1 | 2025-12-08 | 规范化Word文档格式，添加图表插入标记 | AI助手 |
| 2.1.0 | 2025-12-08 | 规范文档格式，增加图表生成标记和图号引用 | Gemini |
| 2.0.0 | 2025-12-07 | 创建详细系统架构文档 | 开发团队 |

---

**版权所有 © 2025 PostureScan Pro 开发团队**

本文档为内部技术文档，未经授权不得传播或用于商业用途。

---

## Word 格式转换说明

### 将此Markdown文档导入Word后，请按以下步骤操作：

#### 1. 页面设置
- **纸张**：布局 → 纸张大小 → A4
- **页边距**：布局 → 页边距 → 自定义（上2.5cm、下2.5cm、左3cm、右2cm）
- **页眉页脚**：
  - 插入 → 页眉 → 编辑页眉，左侧输入"PostureScan Pro 平台系统架构文档"，右侧输入"V2.1.1"
  - 插入 → 页脚 → 页码，选择"第 X 页 共 Y 页"格式

#### 2. 样式设置
- **标题格式化**：
  - 选中一级标题（如"1. 系统架构总览"）→ 开始 → 字体：宋体、二号、加粗
  - 选中二级标题（如"1.1 整体架构图"）→ 字体：宋体、小三、加粗
  - 选中三级标题（如"1.1.1 架构特点"）→ 字体：宋体、四号、加粗
- **正文格式化**：
  - 选中正文 → 字体：中文宋体、英文Times New Roman、小四
  - 段落 → 行距：1.5倍

#### 3. 目录生成
- 将光标放在文档开头（文档信息之后）
- 引用 → 目录 → 自动目录
- 目录页单独占一页（在目录后插入分页符）
- 页码从正文开始编号为1

#### 4. 插入图表
- 搜索文档中的**[此处插入：图X-X XXX]**标记
- 根据标记下方的说明，插入相应的专业图表
- 推荐使用工具：
  - **流程图/架构图**：draw.io、Visio、Lucidchart
  - **ER图**：dbdiagram.io、MySQL Workbench
  - **状态机图**：PlantUML、draw.io
  - **图标库**：Font Awesome、Material Icons、Iconfont

#### 5. 图表格式规范
- 所有图表居中对齐
- 图表下方添加图注（例如：图1-1 平台整体架构图）
- 图注格式：宋体、五号、居中
- 图表与正文之间保留一行空白

#### 6. 表格格式
- 所有表格应用"网格型"样式
- 表头：宋体、小四、加粗、居中、底纹（浅蓝色）
- 表格内容：宋体、小四、居中对齐

#### 7. 代码块格式
- 字体：Consolas或Courier New
- 字号：小四
- 背景色：浅灰色（#F5F5F5）
- 边框：0.5磅实线

#### 8. 最终检查
- 更新目录：右键目录 → 更新域 → 更新整个目录
- 更新所有图表编号
- 检查页眉页脚显示正确
- 检查页码连续性
- 预览打印效果

---

**温馨提示**：
1. 本文档共标记了 **15+ 处图表插入位置**，请确保所有图表都已插入
2. 建议使用统一的配色方案（医疗蓝色系为主）
3. 所有图表建议使用矢量格式（SVG或EMF），确保打印清晰
4. 完成后保存为 `.docx` 格式，文件名：`PostureScan_Pro_系统架构文档_V2.1.1.docx`
